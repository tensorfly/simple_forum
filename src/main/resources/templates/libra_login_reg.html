<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../static/image/favicon-32x32.png" type="image/x-icon"/>
  <title>登录</title>
  <link href="../static/css/bootstrap.min.css" rel="stylesheet">
  <link href="../static/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/css/swiper.min.css">
  <link href="../static/css/libra_login.css" rel="stylesheet">
  <script src="../static/js/ie-emulation-modes-warning.js"></script>
</head>

<body class="libra_login">
  <div class="container-fluid">
    <div class="container">
      <div class="top_nav">
        <p>Libra中文网首页</p>
      </div>
    </div>
    <div class="container container01">
      <div class="login_body">
        <div id="wrap">
          <div id="tit">
            <span>登录</span>
            <span class="select">注册</span>
          </div>
          <ul id="con">
            <li>
              <div class="inner">
                <form id="loginForm" class="form-horizontal" method="post" name="loginForm">
                  <div class="control-group">
                    <!-- <label class="control-label" for="accountId">用户名</label> -->
                    <div class="controls">
                      <i class="icon icon-phone"></i>
                      <input class="input-xlarge" placeholder="输入您的用户名" id="accountId" name="accountId" size="30"
                        type="text">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="password">密码</label> -->
                    <div class="controls">
                      <i class="icon icon-password"></i>
                      <input class="input-xlarge" placeholder="输入您的密码" id="password" name="password" size="30"
                        type="password">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="code">验证码</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="请输入验证码" id="code" name="code" size="4" type="text">
                      <a href="javascript:void(0);" title="点击更换验证码">
                        <img id="imgVerify" src="/code/getVerify?0.41702360044509246" alt="更换验证码"
                          onclick="getVerify(this);">
                      </a>
                    </div>
                  </div>
                  <input type="hidden" name="_csrf" value="M9IWWE3V-1qepEfgBMIgN0j3UAV5v30k1A-k">

                  <div class="form-actions">
                    <input type="submit" class="span-primary" value="" id="login">
                    <!-- <a id="forgot_password" href="search_pass.html">忘记密码了?</a> -->
                  </div>
                </form>
              </div>
            </li>
            <li class="showOn">
              <div class="inner register">
                <div class="alert alert-error" th:if="${flag} eq false">
                  <a class="close" data-dismiss="alert" href="#">&times;</a>
                  <strong th:text="${message}"></strong>
                </div>
                <form id="addUserForm" class="form-horizontal" action="/register" method="post" name="addUserForm"
                  onsubmit="return CheckPost();">
                  <div class="control-group">
                    <!-- <label class="control-label" for="accountId">用户名</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="输入您的用户名" id="accountId" name="accountId" size="30" type="text">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="password">密码</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="输入您的密码" id="password" name="password" size="30" type="password">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="repassword">确认密码</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="请再次输入密码" id="repassword" name="repassword" size="30" type="password">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label">性别</label> -->
                    <div class="controls">
                      <input name="sex" type="radio" checked="checked" value="男">男&nbsp;&nbsp;&nbsp;&nbsp;
                      <input name="sex" type="radio" value="女">女&nbsp;&nbsp;&nbsp;&nbsp;
                      <input name="sex" type="radio" value="保密">保密
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="nickname">昵称</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="输入昵称" id="nickname" name="nickname" size="30" type="text">
                    </div>
                  </div>
                  <div class="control-group">
                    <!-- <label class="control-label" for="email">邮箱</label> -->
                    <div class="controls">
                      <input class="input-xlarge" placeholder="输入邮箱" id="email" name="email" size="30" type="text">
                    </div>
                  </div>
                  <input type="hidden" name="_csrf" value="M9IWWE3V-1qepEfgBMIgN0j3UAV5v30k1A-k">
                  <div class="form-actions">
                    <input type="submit" class="span-primary">
                    <!-- <input type="reset" class="span-primary" value="重置"> -->
                  </div>
                </form>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container footter">
      <p class="cent time">© 2019 Chinaso.com</p>
    </div>
  </div>
  <script src="../static/js/jquery.min.js"></script>
  <script src="../static/js/bootstrap.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="../static/js/ie10-viewport-bug-workaround.js"></script>
  <script>
    $('#tit span').click(function () {
      var i = $(this).index();
      $(this).addClass('select').siblings().removeClass('select');
      $('#con li').eq(i).show().siblings().hide();
    });

    $(function(){
        //首次获取验证码
        $("#imgVerify").attr("src","/code/getVerify?"+Math.random());
    });

    $('#login').click(function(){

        var accountId = $('#accountId').val();
        if(accountId==""){
            alert("请填写用户名！");
            loginForm.accountId.focus();
            return false;
        }
        var password = $('#password').val();
        if(password==""){
            alert("请填写用户密码！");
            loginForm.password.focus();
            return false;
        }

        var code = $("#code").val();
        var flag = false;
        if(code!=null && code!=""){
            code = code.toUpperCase();//将输入的字母全部转换成大写
            $.ajax({
                url : "/code/checkVerify",
                data: {code:code},
                type: 'get',
                dataType: 'json',
                async:false,
                success : function(datas) {
                    flag = datas;
                }
            });
        }else{
            flag = false;
        }
        if(flag){
            alert("验证码校验通过");
            submitForm();//提交表单
        }else{
            alert("请输入正确的验证码");
            loginForm.code.focus();
            return false;
        }


    });

    //提交表单
    function submitForm(){

        document.loginForm.action = "/login";
        document.loginForm.submit();
    }

    //获取验证码
    function getVerify(obj){
        obj.src = "/code/getVerify?"+Math.random();
    }

    //校验验证码
    function checkSum(){
        var code = $("#code").val();
        if(code!=null && code!=""){
            code = code.toUpperCase();//将输入的字母全部转换成大写
            $.ajax({
                url : "/code/checkVerify",
                data: {code:code},
                type: 'get',
                dataType: 'json',
                success : function(datas) {
                    if(datas){
                        submitForm();//提交表单
                    }else {
                        $(".warn_text").text("验证码输入错误！");
                        $(".login_form_warn").css("display","block");
                        return false;
                    }
                }
            });
        }else{
            $(".warn_text").text("请输入验证码！");
            $(".login_form_warn").css("display","block");
            return false;
        }
    }


    function CheckPost ()
    {
        if (addUserForm.accountId.value == "")
        {
            alert("请填写用户名！");
            addUserForm.accountId.focus();
            return false;
        }
        if (addUserForm.password.value.length < 5 )
        {
            alert("密码不能少于5个字符！");
            addUserForm.password.focus();
            return false;
        }
        if (addUserForm.password.value.length > 15 )
        {
            alert("密码不能大于15个字符！");
            addUserForm.password.focus();
            return false;
        }
        if (addUserForm.password.value != addUserForm.repassword.value)
        {
            alert("两次密码不一致！");
            addUserForm.repassword.focus();
            return false;
        }
        if (addUserForm.email.value == ""){
            alert("请填写邮箱账号！");
            addUserForm.accountId.focus();
            return false;
        }
        //邮箱校验
        var mailReg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");
        if(!mailReg.test(addUserForm.email.value)){ //正则验证不通过，格式不对
            alert("邮箱账号不合乎规范!");
            return false;
        }
        return true;
    }
  </script>
</body>

</html>
